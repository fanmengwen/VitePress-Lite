# packages/api-server/Dockerfile.dev

FROM node:22-alpine

WORKDIR /workspace

# Enable pnpm
RUN corepack enable pnpm

# 【新增】安装 openssl 库来修复 Prisma 警告
RUN apk add --no-cache openssl openssl-dev

# Copy workspace manifests for faster install
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/api-server/package.json ./packages/api-server/

# Install dependencies (hoisted)
RUN pnpm install

# Copy source
COPY . .

WORKDIR /workspace/packages/api-server

EXPOSE 3001

# Use dev command by default; compose will override with full init chain
CMD ["pnpm", "dev"]
